name: Reproduce Crash

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  # Control: Same code works on macOS
  macos:
    name: macOS (Swift 6.0) - Works
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v6

      - name: Print Swift version
        run: swift --version

      - name: Build (debug)
        run: swift build -c debug

  # Control: Same code works on Linux
  linux:
    name: Linux (Swift 6.0) - Works
    runs-on: ubuntu-latest
    container: swift:6.0
    steps:
      - uses: actions/checkout@v6

      - name: Build (debug)
        run: swift build -c debug

  # This job reproduces the compiler crash
  windows:
    name: Windows (Swift 6.0) - CRASHES
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v6

      - name: Install Swift
        uses: SwiftyLab/setup-swift@latest
        with:
          swift-version: "6.0"

      - name: Print Swift version
        run: swift --version

      - name: Build (debug) - This crashes the compiler
        run: swift build -c debug -v
